#!/usr/bin/env php
<?php
require __DIR__ . '/vendor/autoload.php';
use Advent\Solutions;
use function Termwind\{render};

$solutions = new Solutions;

/* load all available solvers */
$solvers = collect(scandir('src/Solvers'))
            ->filter(fn($i) => $i[0] !== '.')
            ->map(fn($solver) => '\\Advent\\Solvers\\' . basename($solver, '.php'))
            ->filter(fn($solver) => !isset($argv[1]) || str_contains($solver, str_pad($argv[1], 2, '0', STR_PAD_LEFT)))
            ->map(fn($solver) => new $solver());

if ($solvers->count() === 0) {
    exit;
}

/* solve them */
foreach($solvers as $solver) {
    $input = collect(input("inputs/{$solver->puzzle()}.txt"));
    $solver->solve($input, $solutions);
}


/* now render the output in a nice table */
$total_time = 0;
$table = <<<HTML
    <div>
        <table>
            <thead>
                <tr>
                    <th class='text-center'>PUZZLE</th>
                    <th class='text-center'>TITLE</th>
                    <th class='text-center'>ANSWER</th>
                    <th class='text-center'>RUNTIME</th>
                </tr>
            </thead>
HTML;

foreach($solutions->all() as $solution) {
    [$puzzle, $title, $value, $time] = $solution;
    $total_time += $time;
    $time = round(($time)*1000,3);

    $table .= <<<HTML
        <tr class='text-center'>
          <td class='text-center text-yellow-400'>{$puzzle}</td>
          <td class='text-center text-yellow-400'>{$title}</td>
          <td class='text-center text-green-400'>{$value}</td>
          <td class='text-center text-blue-400'>{$time} ms</td>
        </tr>
   HTML;
}

$total_time = round(($total_time)*1000,3);

$table .= <<<HTML
        <tr>
                          <td class='text-center text-yellow-400'></td>
                        <td class='text-center text-yellow-400'></td>
                        <td class='text-center text-green-400'></td>
                        <td class='text-center text-blue-400'>---------</td>
        </tr>
        <tr>
                          <td class='text-center text-yellow-400'></td>
                        <td class='text-center text-yellow-400'></td>
                        <td class='text-center text-green-400'></td>
                        <td class='text-center text-blue-400'>{$total_time} ms</td>
        </tr>
        </table>
    </div>
HTML;

render($table);

